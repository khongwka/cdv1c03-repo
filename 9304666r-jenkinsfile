groovy

pipeline {
  agent {
    node {
        label 'master'
    }
  }
  
  tools {
      maven 'maven3'
  }

  // FIXED OPTIONS BLOCK
  options {
      buildDiscarder(logRotator(
          daysToKeepStr: '15',
          numToKeepStr: '10'
      ))
  }

  environment {
      APP_NAME = "STUDENT_APP"
      APP_ENV = "DEV"
  }

  stages {
    stage('Cleanup Workspace') {
      steps {
          cleanWs()
          sh """
          echo "Cleaned Up Workspace for ${APP_NAME}"
          """
        }
      }
    
    stage('Code Checkout') {
      steps {
          checkout([
              $class: 'GitSCM',
              branches: [[name: '*/main']], 
              userRemoteConfigs: [[
                  url: 'https://github.com/khongwka/cdv1c03-repo.git'
              ]]
          ])
      }
    }

    stage('Code Build') {
        steps {
            sh 'mvn install -Dmaven.test.skip=false'
        }
    }

    stage('Printing All Global Variables'){
        steps {
            sh """
            env
            """
        }
      }
    }
}groovy

pipeline {
  agent {
    node {
        label 'master'
    }
  }
  
  tools {
      maven 'maven3'
  }

  options {
      buildDiscarder logRotator(
                  daysToKeepStr: '15',
                  numToKeepStr: '10'
          )
  }

  environment {
      APP_NAME = "STUDENT_APP"
      APP_ENV = "DEV"
  }

  stages {
    stage('Cleanup Workspace') {
      steps {
          cleanWs()
          sh """
          echo "Cleaned Up Workspace for ${APP_NAME}"
          """
        }
      }
    
    stage('Code Checkout') {
      steps {
          checkout([
              $class: 'GitSCM',
              branches: [[name: '*/main']],  // Fixed: plural 'branches'
              userRemoteConfigs: [[
                  url: 'https://github.com/khongwka/cdv1c03-repo.git'  // Fixed URL
              ]]
          ])
      }
    }

    stage('Code Build') {
        steps {
            sh 'mvn install -Dmaven.test.skip=false'
        }
    }

    stage('Printing All Global Variables'){
        steps {
            sh """
            env
            """
        }
      }
    }
}
